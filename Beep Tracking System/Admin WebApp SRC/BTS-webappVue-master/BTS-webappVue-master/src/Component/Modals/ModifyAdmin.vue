<template> <div class="ui mini modal" id="modifyAdminModal"> <div class="header">Modify Admin</div><i class="close icon"> </i> <div class="content"> <div class="ui negative message" v-if="errMessage.length !==0"> <div class="header item">Error</div><ul> <li :key="messages.code" v-for="messages in errMessage">{{messages}}</li></ul> </div><form class="ui form" :class="loading?'loading':''" @submit.prevent="confirmEdit()"> <div class="field"> <label>First Name</label> <input type="text" v-model="admin.fname"> </div><div class="field"> <label>Last Name</label> <input type="text" v-model="admin.lname"> </div><div class="field"> <label>Contact Number</label> <input v-model="admin.contact_number" type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value=this.value.slice(0, this.maxLength);" name="cnum" placeholder="Enter Contact Number" min=0 autoComplete="off" maxlength="11"> </div><div class="field"> <label>E-mail</label> <input type="text" v-model="admin.email"> </div><div class="field"> <label>Position</label> <select v-model="admin.position" class="ui fluid dropdown"> <option value="staff">Staff</option> <option value="manager">Manager</option> </select> </div><button class="ui orange fluid button" type="button" @click="ShowChangePass()">Change/Reset Password</button> <div class="ui divider"></div><button class="ui fluid red button" type="button" @click="showDelAdmin()">Delete Admin</button> <div class="ui divider"></div><button class="ui green fluid button" type="submit">Confirm Edits</button> </form> </div><success :content="SucceedContent"/> <changePass :creds="creds"/> <delAdmin :creds="creds"/> </div></template><script>import{required}from '@/utils/validations.js'import success from '@/Component/SuccessPopUp'import changePass from '@/Component/Modals/ChangePasswordAdmin'import delAdmin from '@/Component/Modals/DeleteAdmin'import firebase from 'firebase/app'var config={apiKey: 'AIzaSyAhJjt15mqS0p7a1a77TF8zDm6EHjVuoYQ', authDomain: 'firebase-adminsdk-v2kv5@beep-db-d2d2b.iam.gserviceaccount.com', databaseURL: "https://beep-db-d2d2b.firebaseio.com",};var modifyAdminAuth=firebase.initializeApp(config,"Fourth")import $ from 'jquery';window.$=window.jQuery=$;export default{components:{success, changePass, delAdmin}, props:{admin:{type: Object,}, loading:{type: Boolean}, creds:{}}, data(){return{SucceedContent: '', errMessage: [], ShowChangePassVar: false}}, methods:{showDelAdmin(){$('#delAdminModal').modal('show')}, ShowChangePass(){$('.ui.modal') .modal({allowMultiple: false, closable: false,}) $('#changePassModal').modal('show')}, confirmEdit(){var $this=this var count=0 this.loading=true modifyAdminAuth .auth() .signInWithEmailAndPassword($this.creds.email,$this.creds.password) .then(function(){$this.errMessage=[] $this.errMessage.push(required($this.admin.fname,'First Name')) $this.errMessage.push(required($this.admin.lname,'Last Name')) $this.errMessage.push(required($this.admin.contact_number,'Contact Number')) $this.errMessage.push(required($this.admin.email,'E-mail')) $this.errMessage.push(required($this.admin.position,'Position')) count=$this.errMessage.length while(count--){if ($this.errMessage[count].length < 1){$this.errMessage.splice(count, 1);}}if($this.errMessage.length < 1){var user=modifyAdminAuth.auth().currentUser $this.admin.fname=$this.admin.fname[0].toUpperCase() + $this.admin.fname.slice(1) $this.admin.lname=$this.admin.lname[0].toUpperCase() + $this.admin.lname.slice(1) user.updateEmail($this.admin.email) .then(function(){$this.$db.collection('admin') .doc(user.uid) .update({fname: $this.admin.fname, lname: $this.admin.lname, contact_number: $this.admin.contact_number, email: $this.admin.email, position: $this.admin.position, date_updated: new Date()}) $this.SucceedContent='Admin Modified!' modifyAdminAuth.auth().signOut() $('#successModal').modal('show') $this.loading=false}) .catch(function(err){$this.errMessage=[] modifyAdminAuth.auth().signOut() $this.errMessage.push(err.message) $this.loading=false})}else{$this.loading=false modifyAdminAuth.auth().signOut()}})},},}</script>