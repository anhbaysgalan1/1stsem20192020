<template> <div class="ui mini modal" id="modifyDriverModal"> <div class="header">Modify Driver</div><i class="close icon"> </i> <div class="content"> <div class="ui negative message" v-if="errMessage.length !==0"> <div class="header item">Error</div><ul> <li :key="messages.code" v-for="messages in errMessage">{{messages}}</li></ul> </div><form class="ui form" :class="loading?'loading':''" @submit.prevent="confirmEdit()"> <div class="field"> <label>First Name</label> <input type="text" v-model="driver.fname"> </div><div class="field"> <label>Last Name</label> <input type="text" v-model="driver.lname"> </div><div class="field"> <label>Contact Number</label> <input v-model="driver.contact_number" type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value=this.value.slice(0, this.maxLength);" name="cnum" placeholder="Enter Contact Number" min=0 autoComplete="off" maxlength="11"> </div><div class="field"> <label>E-mail</label> <input type="text" v-model="driver.email"> </div><div class="field"> <label>License Number</label> <input type="text" v-model="driver.license_number"> </div><div class="ui divider"></div><button class="ui fluid red button" type="button" @click="showDelDriver()">Delete Driver</button> <div class="ui divider"></div><button class="ui green fluid button" type="submit">Confirm Edits</button> </form> </div><success :content="SucceedContent"/> <delDriver :creds="creds"/> </div></template><script>import{required}from '@/utils/validations.js'import success from '@/Component/SuccessPopUp'import delDriver from '@/Component/Modals/DeleteDriver'import firebase from 'firebase/app'var config={apiKey: 'AIzaSyAhJjt15mqS0p7a1a77TF8zDm6EHjVuoYQ', authDomain: 'firebase-adminsdk-v2kv5@beep-db-d2d2b.iam.gserviceaccount.com', databaseURL: "https://beep-db-d2d2b.firebaseio.com",};var modifyDriverAuth=firebase.initializeApp(config,"tenth")import $ from 'jquery';window.$=window.jQuery=$;export default{components:{success, delDriver}, props:{driver:{type: Object,}, loading:{type: Boolean}, creds:{}}, data(){return{SucceedContent: '', errMessage: [], ShowChangePassVar: false}}, methods:{showDelDriver(){$('#delDriverModal').modal('show')}, confirmEdit(){var $this=this var count=0 this.loading=true modifyDriverAuth .auth() .signInWithEmailAndPassword($this.creds.email,$this.creds.password) .then(function(){$this.errMessage=[] $this.errMessage.push(required($this.driver.fname,'First Name')) $this.errMessage.push(required($this.driver.lname,'Last Name')) $this.errMessage.push(required($this.driver.contact_number,'Contact Number')) $this.errMessage.push(required($this.driver.email,'E-mail')) $this.errMessage.push(required($this.driver.license_number,'License Number')) count=$this.errMessage.length while(count--){if ($this.errMessage[count].length < 1){$this.errMessage.splice(count, 1);}}if($this.errMessage.length < 1){var user=modifyDriverAuth.auth().currentUser $this.driver.fname=$this.driver.fname[0].toUpperCase() + $this.driver.fname.slice(1) $this.driver.lname=$this.driver.lname[0].toUpperCase() + $this.driver.lname.slice(1) user.updateEmail($this.driver.email) .then(function(){$this.$db.collection('driver') .doc(user.uid) .update({fname: $this.driver.fname, lname: $this.driver.lname, contact_number: $this.driver.contact_number, email: $this.driver.email, license_number: $this.driver.license_number, date_updated: new Date()}) $this.SucceedContent='Driver Modified!' modifyDriverAuth.auth().signOut() $('#successModal').modal('show') $this.loading=false}) .catch(function(err){$this.errMessage=[] modifyDriverAuth.auth().signOut() $this.errMessage.push(err.message) $this.loading=false})}else{$this.loading=false modifyDriverAuth.auth().signOut()}})},},}</script>