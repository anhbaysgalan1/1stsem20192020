<template> <div> <div class="ui tiny modal" id="adminModal"> <div class="header" id="header">Register New Admin</div><div class="content"> <div class="ui negative message" v-if="formStatus.errMessage.length !==0"> <div class="header item">Error</div><ul> <li :key="messages.code" v-for="messages in formStatus.errMessage">{{messages}}</li></ul> </div><form class="ui form" @submit.prevent="checkForm()" :class="(formStatus.loading)?'loading':''"> <div class="ui two column grid" autocomplete="off"> <div class="column"> <div class="field" :class="input.fname?'error':''"> <label for="fname">First Name</label> <input v-model="admin.fname" type="text" name="fname" placeholder="Enter First Name" autoComplete="off"> </div></div><div class="column"> <div class="field" :class="input.lname?'error':''"> <label for="lname">Last Name</label> <input v-model="admin.lname" type="text" name="lname" placeholder="Enter Last Name" autoComplete="off"> </div></div></div><div class="ui two column grid"> <div class="column"> <div class="field" :class="input.cnum?'error':''"> <label for="cnum">Contact Number</label> <input v-model="admin.cnum" type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value=this.value.slice(0, this.maxLength);" name="cnum" placeholder="Enter Contact Number" min=0 autoComplete="off" maxlength="11"> </div></div><div class="column"> <div class="field" :class="input.position?'error':''"> <label for="cnum">Position</label> <select v-model="admin.position" class="ui fluid dropdown"> <option value="staff">Staff</option> <option value="manager">Manager</option> </select> </div></div></div><div class="ui one column grid"> <div class="column"> <div class="field" :class="input.email?'error':''"> <label for="email">E-mail</label> <input v-model="admin.email" type="email" name="email" placeholder="Enter e-mail" autoComplete="off"> </div></div></div><div class="ui two column grid"> <div class="column"> <div class="field" :class="input.password?'error':''"> <label for="password">Password</label> <input v-model="admin.password" type="password" maxlength="12" name="password" placeholder="Enter Password"> </div></div><div class="column"> <div class="field" :class="input.password?'error':''"> <label for="password2">Retype Password</label> <input v-model="admin.repassword" type="password" maxlength="12" name="password2" placeholder="Retype Password"> </div></div></div><div class="actions"> <div class="ui two column grid"> <div class="column"> <button class="ui fluid green button" type="submit">Add</button> </div><div class="column"> <button class="ui fluid deny red button" type="button">Cancel</button> </div></div></div></form> </div></div><success :content="SucceedContent"></success> </div></template><script>import{required,password}from '@/utils/validations.js'import success from '@/Component/SuccessPopUp'import firebase from 'firebase/app'var config={apiKey: 'AIzaSyAhJjt15mqS0p7a1a77TF8zDm6EHjVuoYQ', authDomain: 'firebase-adminsdk-v2kv5@beep-db-d2d2b.iam.gserviceaccount.com', databaseURL: "https://beep-db-d2d2b.firebaseio.com",};var adminAuth=firebase.initializeApp(config,"Third")import $ from 'jquery';window.$=window.jQuery=$;export default{components:{success}, data(){return{SucceedContent: '', formStatus:{loading: false, errMessage: []}, input:{fname: false, lname: false, cnum: false, email: false, password: false, position: false,}, admin:{fname: '', lname: '', cnum: '', email: '', password: '', repassword: '', position: ''}}}, methods:{checkForm(){var $this=this var count=0 this.formStatus.loading=true this.formStatus.errMessage=[] this.formStatus.errMessage.push(required(this.admin.fname,'First Name')) this.formStatus.errMessage.push(required(this.admin.lname,'Last Name')) this.formStatus.errMessage.push(required(this.admin.cnum,'Contact Number')) this.formStatus.errMessage.push(required(this.admin.email,'E-mail')) this.formStatus.errMessage.push(required(this.admin.position,'Position')) if(required(this.admin.password,'Password').length < 1){this.formStatus.errMessage.push(password(this.admin.password,this.admin.repassword)) this.formStatus.loading=false}else{this.formStatus.errMessage.push(required(this.admin.password,'Password')) this.formStatus.loading=false}this.formStatus.errMessage.push(required(this.admin.repassword,'Retype Password')) /*Splicing non-errors in the arrays*/ count=this.formStatus.errMessage.length while(count--){if (this.formStatus.errMessage[count].length < 1){this.formStatus.errMessage.splice(count, 1);}}if(this.formStatus.errMessage.length < 1){this.formStatus.loading=true adminAuth.auth().createUserWithEmailAndPassword($this.admin.email, $this.admin.password) .then(function(data){$this.sendForm(data.user.uid)}) .catch(function(err){$this.formStatus.errMessage=[] $this.formStatus.errMessage.push(err.message) $this.formStatus.loading=false})}}, sendForm(userID){var $this=this /*add data to firestore*/ $this.admin.fname=$this.admin.fname[0].toUpperCase() + $this.admin.fname.slice(1) $this.admin.lname=$this.admin.lname[0].toUpperCase() + $this.admin.lname.slice(1) $this.$db.collection("admin").doc(userID) .set({fname: $this.admin.fname, lname: $this.admin.lname, contact_number: $this.admin.cnum, email: $this.admin.email, position: $this.admin.position, password: $this.admin.password, status: 'active', date_created: new Date(), date_updated: new Date()}) adminAuth.auth().signOut() /*Unset fields and perform popup success*/ .then(function(){$('#successModal').modal('show') $this.SucceedContent='New Admin has been added!' $this.formStatus.loading=false $this.admin.fname='' $this.admin.lname='' $this.admin.cnum='' $this.admin.email='' $this.admin.position='' $this.admin.password='' $this.admin.repassword=''})},}}</script>