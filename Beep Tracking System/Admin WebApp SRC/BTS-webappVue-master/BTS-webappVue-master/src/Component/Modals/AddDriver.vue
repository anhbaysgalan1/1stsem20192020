<template> <div> <div class="ui tiny modal" id="driverModal"> <div class="header" id="header">Register New Driver</div><div class="content"> <div class="ui negative message" v-if="formStatus.errMessage.length !==0"> <div class="header item">Error</div><ul> <li :key="messages.code" v-for="messages in formStatus.errMessage">{{messages}}</li></ul> </div><form class="ui form" @submit.prevent="checkForm()" :class="formStatus.loading?'loading':''"> <div class="ui two column grid" autocomplete="off"> <div class="column"> <div class="field" :class="input.fname?'error':''"> <label for="fname">First Name</label> <input v-model="driver.fname" type="text" name="fname" placeholder="Enter First Name" autoComplete="off"> </div></div><div class="column"> <div class="field" :class="input.lname?'error':''"> <label>Last Name</label> <input v-model="driver.lname" type="text" name="lname" placeholder="Enter Last Name" autoComplete="off"> </div></div></div><div class="ui two column grid"> <div class="column"> <div class="field" :class="input.cnum?'error':''"> <label>Contact Number</label> <input v-model="driver.cnum" type="number" oninput="javascript: if (this.value.length > this.maxLength) this.value=this.value.slice(0, this.maxLength);" name="cnum" placeholder="Enter Contact Number" min=0 autoComplete="off" maxlength="11"> </div></div><div class="column"> <div class="field" :class="input.license_number?'error':''"> <label>License Number</label> <input v-model="driver.license_number" type="text" name="lname" placeholder="Enter License Number" autoComplete="off"> </div></div></div><div class="ui one column grid"> <div class="column"> <div class="field" :class="input.email?'error':''"> <label for="email">E-mail</label> <input v-model="driver.email" type="email" name="email" placeholder="Enter e-mail" autoComplete="off"> </div></div></div><div class="ui two column grid"> <div class="column"> <div class="field" :class="input.password?'error':''"> <label for="password">Password</label> <input v-model="driver.password" type="password" name="password" maxlength="12" placeholder="Enter Password"> </div></div><div class="column"> <div class="field" :class="input.password?'error':''"> <label for="password2">Retype Password</label> <input v-model="driver.repassword" type="password" name="password2" maxlength="12" placeholder="Retype Password"> </div></div></div><div class="actions"> <div class="ui two column grid"> <div class="column"> <button class="ui fluid green button" type="submit">Add</button> </div><div class="column"> <button class="ui fluid deny red button" type="button">Cancel</button> </div></div></div></form> </div></div><success :content="SucceedContent"></success> </div></template><script>import{required, password}from '@/utils/validations.js'import success from '@/Component/SuccessPopUp'import firebase from 'firebase/app'var config={apiKey: 'AIzaSyAhJjt15mqS0p7a1a77TF8zDm6EHjVuoYQ', authDomain: 'firebase-adminsdk-v2kv5@beep-db-d2d2b.iam.gserviceaccount.com', databaseURL: "https://beep-db-d2d2b.firebaseio.com",};var driverAuth=firebase.initializeApp(config,"Second")import $ from 'jquery';window.$=window.jQuery=$;export default{components:{success}, data(){return{SucceedContent: '', formStatus:{loading: false, errMessage: []}, input:{fname: false, lname: false, license_number: false, email: false, password: false, repassword: false, cnum: false}, driver:{fname: '', lname: '', cnum: '', license_number: '', email: '', password: '', repassword: '',}}}, methods:{checkForm(){var $this=this var count=0 this.formStatus.loading=true this.formStatus.errMessage=[] this.formStatus.errMessage.push(required(this.driver.fname,'First Name')) this.formStatus.errMessage.push(required(this.driver.lname,'Last Name')) this.formStatus.errMessage.push(required(this.driver.cnum,'Contact Number')) this.formStatus.errMessage.push(required(this.driver.license_number,'License Number')) this.formStatus.errMessage.push(required(this.driver.email,'E-mail')) if(required(this.driver.password,'Password').length < 1){this.formStatus.errMessage.push(password(this.driver.password,this.driver.repassword)) this.formStatus.loading=false}else{this.formStatus.errMessage.push(required(this.driver.password,'Password')) this.formStatus.loading=false}this.formStatus.errMessage.push(required(this.driver.repassword,'Retype Password')) /*Splicing non-errors in the arrays*/ count=this.formStatus.errMessage.length while(count--){if (this.formStatus.errMessage[count].length < 1){this.formStatus.errMessage.splice(count, 1);}}if(this.formStatus.errMessage.length < 1){this.formStatus.loading=true driverAuth.auth().createUserWithEmailAndPassword($this.driver.email, $this.driver.password) .then(function(data){$this.sendForm(data.user.uid)}) .catch(function(err){$this.formStatus.errMessage=[] $this.formStatus.errMessage.push(err.message) $this.formStatus.loading=false})}}, sendForm(userID){var $this=this /*add data to firestore*/ $this.driver.fname=$this.driver.fname[0].toUpperCase() + $this.driver.fname.slice(1) $this.driver.lname=$this.driver.lname[0].toUpperCase() + $this.driver.lname.slice(1) $this.$db.collection("driver").doc(userID) .set({fname: $this.driver.fname, lname: $this.driver.lname, contact_number: $this.driver.cnum, license_number: $this.driver.license_number, email: $this.driver.email, password: $this.driver.password, status: 'active', date_created: new Date(), date_updated: new Date()}) driverAuth.auth().signOut() /*Unset fields and perform animation succeed*/ .then(function(){$('#successModal').modal('show') $this.SucceedContent='New Driver has been added!' $this.formStatus.loading=false $this.driver.fname='' $this.driver.lname='' $this.driver.cnum='' $this.driver.email='' $this.driver.license_number='' $this.driver.password='' $this.driver.repassword=''})},}}</script>