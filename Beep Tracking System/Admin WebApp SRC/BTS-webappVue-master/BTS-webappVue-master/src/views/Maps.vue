<template> <div class="ui segment" :class="elementStyle?'inverted':''"> <div class="ui grid"> <div class="eleven wide column"> <GmapMap :center="mapCenter" :zoom="14" map-type-id="roadmap" style="width: 100%; height: 90vh" :options="{styles: style, zoomControl: false, mapTypeControl: false, scaleControl: false, streetViewControl: false, rotateControl: false, fullscreenControl: true, disableDefaultUi: false, clickableIcons: false, panControlOptions: false, gestureHandling: 'greedy'}" > <GmapMarker v-for="(pin, index) in beepStopFilter" :key="index" :position="pin.location" :clickable="true" :draggable="false" @click="center=pin.location" :icon="beepStopMarkerOption"/> <GmapMarker v-for="(pin, index) in beepFilter" :key="index+2000" :position="pin.location" :clickable="true" :draggable="false" @click="center=pin.location" :icon="beepUnitMarkerOption"/> </GmapMap> </div><div class="five wide column"> <div class="ui segment" :class="elementStyle?'grey inverted':''" style="max-height: 90vh; overflow-y: auto;"> <table class="ui left aligned single fixed line table" :class="elementStyle?'inverted':''"> <thead> <tr> <th colspan="4"> <div class="ui buttons"> <button class="ui black button" @click="mapStyle(1)">Dark Mode</button> <button class="ui button" @click="mapStyle(0)">Normal Mode</button> </div></th> </tr><tr> <th colspan="2"> <select class="ui fluid dropdown" v-model="routeFilter"> <option value=0>All</option> <option :key="route.route" v-for="route in routes" :value="route.route">Route{{route.route}}:{{route.name}}</option> </select> </th> <th colspan="2"></th> </tr><tr> <th>Beep Unit</th> <th colspan="">Route</th> <th>Driver Name</th> <th></th> </tr></thead> <tbody> <tr :key="beep.beep" v-for="beep in beepFilter"> <td>{{beep.beep}}</td><td>Route{{beep.route}}</td><td>{{beep.driver}}</td><td><button class="ui button" :class="elementStyle?'black':'basic primary'" @click="moveToLocation(beep.location.lat,beep.location.lng)">Center</button></td></tr></tbody> </table> </div></div></div><!-- <div :key="beepStop.name" v-for="beepStop in beepStops">{{beepStop}}<br></div>--> </div></template><script>import{gmapApi}from 'vue2-google-maps'import{defaultStyle, nightMode}from '@/utils/mapStyles.js'export default{data(){return{mapCenter:{lat: 10.31, lng: 123.899}, beepStops:[], beepUnit:[], beepStopMarkerOption:{url: require('@/assets/logo123.png'), size:{width: 50, height: 50, f: 'px', b: 'px',}, scaledSize:{width: 50, height: 50, f: 'px', b: 'px',},}, beepUnitMarkerOption:{url: require('@/assets/beep.png'), size:{width: 30, height: 30, f: 'px', b: 'px',}, scaledSize:{width: 30, height: 30, f: 'px', b: 'px',},}, style: defaultStyle, elementStyle: false, routes: [], routeFilter: ''}}, computed:{google: gmapApi, beepStopFilter(){let filtered=this.beepStops if(this.routeFilter !=0){filtered=this.beepStops.filter(el=> el.route==this.routeFilter)}return filtered}, beepFilter(){let filtered=this.beepUnit if(this.routeFilter !=0){filtered=this.beepUnit.filter(el=> el.route==this.routeFilter)}return filtered}}, methods:{routeList(){var $this=this this.$db.collection('route') .get() .then(function(querySnapshot){querySnapshot.forEach(function(doc){$this.routes.push(doc.data())})})}, mapStyle(mode){if(mode===1){this.style=nightMode this.elementStyle=true}else{this.style=defaultStyle this.elementStyle=false}}, moveToLocation(Lat, Lng){this.mapCenter.lat=Lat this.mapCenter.lng=Lng}, beepStopsMarker(){var $this=this var stops=[] this.$db.collection('busStop') .onSnapshot(function(querySnapshot){$this.beepStops=[] stops=[] querySnapshot.forEach(function(doc){stops.push(doc.data())}) stops.forEach(function(item){$this.beepStops.push({name: item.route, status: item.name, route: item.route, location:{lat: item.location._lat, lng: item.location._long}})})})}, beepsRunningMarker(){var $this=this var beeps=[] this.$db.collection('bus') .where('status','==',1) .onSnapshot(function(querySnapshot){$this.beepUnit=[] beeps=[] querySnapshot.forEach(function(doc){beeps.push(doc.data())}) beeps.forEach(function(item){$this.beepUnit.push({driver: item.driver, beep: item.name, route: item.route, location:{lat: item.position.geopoint._lat, lng: item.position.geopoint._long}})})})}}, mounted(){this.beepStopsMarker() this.beepsRunningMarker() this.routeList() document.title='BTS | Maps'}}</script>