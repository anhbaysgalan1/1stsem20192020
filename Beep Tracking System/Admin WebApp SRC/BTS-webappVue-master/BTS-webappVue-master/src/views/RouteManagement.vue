<template> <div> <div class="ui segment"> <div class="ui grid"> <div class="eleven wide column"> <GmapMap :center="mapCenter" :zoom="14" map-type-id="roadmap" style="width: 100%; height: 90vh" :options="{styles: style, zoomControl: false, mapTypeControl: false, scaleControl: false, streetViewControl: false, rotateControl: false, fullscreenControl: false, disableDefaultUi: false, clickableIcons: false, panControlOptions: false, gestureHandling: 'greedy'}" > <GmapMarker v-for="(pin, index) in inputs" :key="index+2000" :position="pin.location" :clickable="true" :draggable="true" @dragend="updateMarker(index,$event)" :icon="beepStopMarkerOption"/> </GmapMap> </div><div class="five wide column"> <div class="ui segment"> <h3 class="ui header">Add Routes</h3> <div class="ui divider"></div><!-- <div class="content"> <div class="ui two column grid"> <div class="column"> <select name="" id="" class="ui fluid dropdown" @change="beepStopList()" v-model="filterRoute"> <option :key="route.index" v-for="route in routes" :value="route.route">Route{{route.route}}:{{route.name}}</option> </select> </div><div class="column"> <button class="ui green fluid button">New Route</button> </div></div></div><div class="ui divider"></div><div class="content"> <div :key="stops.index" v-for="stops in beepStops"> <button class="ui green button" @click="moveToLocation(stops.location.lat,stops.location.lng)">Center</button> Lat: <div class="ui disabled input"> <input type="text" v-model="stops.location.lat"> </div>Long: <div class="ui disabled input"> <input type="text" v-model="stops.location.lng"> </div></div></div><br><button class="ui primary button" @click="updateBeepStop()">Confirm Edit</button> <div class="ui divider"></div>--> <div class="content"> <button class="ui primary button" @click="addRow()">Add New Beep Stop</button> <button class="ui primary button" @click="deleteRow()">Delete Last Beep Stop</button> <div class="ui input"> <input type="text" v-model="routeName" placeholder="Add Route Name"> </div><div class="ui divider"></div><form class="ui form"> <div :key="input.index" v-for="input in inputs"> <div class="field"> <label>Description</label> <input type="text" v-model="input.name" placeholder="beep stop description"> </div></div></form> <div class="ui divider"></div><button class="ui green button" @click="addBeepStop()">Confirm Route</button> </div></div></div></div></div></div></template><script>import{defaultStyle}from '@/utils/mapStyles.js'import firebase from 'firebase/app'export default{data(){return{style: defaultStyle, mapCenter:{lat: 10.31, lng: 123.899}, beepStopMarkerOption:{url: require('@/assets/logo123.png'), size:{width: 50, height: 50, f: 'px', b: 'px',}, scaledSize:{width: 50, height: 50, f: 'px', b: 'px',},}, routeName: '', inputs: [{name: "", location:{lat: 10.2934228, lng: 123.8997146}}], henlo: 0}}, methods:{addBeepStop(){var $this=this var routeCount=0 var beepStopCount=0 this.$db.collection('route') .get() .then(function(querySnapshot){querySnapshot.forEach(function(){routeCount++;})}) .then(function(){var docString='route'+(routeCount+1).toString() var busRouteString='busRoute'+(routeCount+1).toString() $this.$db.collection('route') .doc(docString) .set({busStopId: busRouteString, name: $this.routeName, route: (routeCount+1).toString()})}) .then(function(){$this.$db.collection('busStop') .get() .then(function(querySnapshot){querySnapshot.forEach(function(){beepStopCount++})}) .then(function(){var arrayCount=0 Object.keys($this.inputs).forEach(function(key){arrayCount++ $this.$db.collection('busStop') .doc('busStop'+(beepStopCount+arrayCount).toString()) .set({location: new firebase.firestore.GeoPoint($this.inputs[key].location.lat,$this.inputs[key].location.lng), name: $this.inputs[key].name, route: (routeCount+1).toString()})})})})}, addRow(){this.inputs.push({name: "", location:{lat: 10.2934228, lng: 123.8997146}})}, deleteRow(){this.inputs.pop()}, updateMarker(index,location){Object.assign(this.inputs[index],{location:{lat: location.latLng.lat(), lng: location.latLng.lng()}})},}, computed:{}, mounted(){document.title='BTS | Route Management'}}</script>